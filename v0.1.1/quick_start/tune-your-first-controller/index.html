<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tune your first controller · AutomationLabs.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">AutomationLabs.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><span class="tocitem">Home</span><ul><li><a class="tocitem" href="../../">AutomationLabs.jl documentation</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../../installation/installation/">Installation with Julia</a></li></ul></li><li><span class="tocitem">Quick start</span><ul><li><a class="tocitem" href="../introductory/">Introduction</a></li><li><a class="tocitem" href="../manage-your-first-data/">Manage your first data</a></li><li><a class="tocitem" href="../tune-your-first-model/">Tune your first model</a></li><li class="is-active"><a class="tocitem" href>Tune your first controller</a><ul class="internal"><li><a class="tocitem" href="#Prepare-a-model-for-tuning-a-controller"><span>Prepare a model for tuning a controller</span></a></li><li><a class="tocitem" href="#Tune-a-linear-controller"><span>Tune a linear controller</span></a></li><li><a class="tocitem" href="#Tune-a-non-linear-controller"><span>Tune a non-linear controller</span></a></li><li><a class="tocitem" href="#Tune-a-mixed-integer-controller"><span>Tune a mixed integer controller</span></a></li><li><a class="tocitem" href="#Calculate-a-controller"><span>Calculate a controller</span></a></li><li><a class="tocitem" href="#Delete-a-controller"><span>Delete a controller</span></a></li><li><a class="tocitem" href="#Reference"><span>Reference</span></a></li></ul></li></ul></li><li><span class="tocitem">Guides</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Administrate projects</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../guides/projects/administrate-projects/">Interact with projects</a></li><li><a class="tocitem" href="../../guides/projects/parameters/">Parameters</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Administrate data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../guides/data/administrate-data/">Interact with data</a></li><li><a class="tocitem" href="../../guides/data/parameters/">Parameters</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Administrate models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../guides/models/administrate-models/">Interact with models</a></li><li><a class="tocitem" href="../../guides/models/blackbox-models-description/">Blackbox models description</a></li><li><a class="tocitem" href="../../guides/models/hyperparameters-optimization/">Hyperparameters optimization</a></li><li><a class="tocitem" href="../../guides/models/exploration-of-models/">Exploration of models</a></li><li><a class="tocitem" href="../../guides/models/loss-function/">Loss functions</a></li><li><a class="tocitem" href="../../guides/models/solvers/">Solvers</a></li><li><a class="tocitem" href="../../guides/models/manage-the-electronic-circuit/">Manage the electronic circuit</a></li><li><a class="tocitem" href="../../guides/models/parameters/">Parameters</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Administrate controllers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../guides/controllers/administrate-controllers/">Interact with controllers</a></li><li><a class="tocitem" href="../../guides/controllers/model-predictive-control/">Model predictive control</a></li><li><a class="tocitem" href="../../guides/controllers/economic-model-predictive-control/">Economic model predictive control</a></li><li><a class="tocitem" href="../../guides/controllers/solvers/">Solvers</a></li><li><a class="tocitem" href="../../guides/controllers/parameters/">Parameters</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Administrate dashboards</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../guides/dashboards/administrate-dashboards/">Interact with dashboards</a></li><li><a class="tocitem" href="../../guides/dashboards/parameters/">Parameters</a></li></ul></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../reference/cli/">CLI</a></li></ul></li><li><span class="tocitem">Collaboration</span><ul><li><a class="tocitem" href="../../collaboration/how-to-contribute/">How to contribute</a></li></ul></li><li><span class="tocitem">Roadmap</span><ul><li><a class="tocitem" href="../../roadmap/planned-for-v0.2.x/">Planned for v2.0.x</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Quick start</a></li><li class="is-active"><a href>Tune your first controller</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tune your first controller</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/AutomationLabs-sh/AutomationLabs.jl/blob/main/docs/src/quick_start/tune-your-first-controller.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tune-your-first-controller"><a class="docs-heading-anchor" href="#Tune-your-first-controller">Tune your first controller</a><a id="Tune-your-first-controller-1"></a><a class="docs-heading-anchor-permalink" href="#Tune-your-first-controller" title="Permalink"></a></h1><p>From a model, it is possible to create a controller based on model predictive control, and it will be saved on the database. It can be set to be linear or non-linear and the solver can be selected by the user or automatically. In addition, it will be possible to calculate the controller from the initialization of the states to compute the optimal state and input control. In this tutorial you will learn:</p><ul><li><a href="#Prepare-a-model-for-tuning-a-controller">Prepare a model for tuning a controller</a></li><li><a href="#Tune-a-linear-controller">Tune a linear controller</a></li><li><a href="#Tune-a-non-linear-controller">Tune a non linear controller</a></li><li><a href="#Tune-a-mixed-integer-controller">Tune a mixed integer controller</a></li><li><a href="quick_start/@ref">Calculate a controller</a></li><li><a href="#Delete-a-controller">Delete a controller</a></li></ul><h2 id="Prepare-a-model-for-tuning-a-controller"><a class="docs-heading-anchor" href="#Prepare-a-model-for-tuning-a-controller">Prepare a model for tuning a controller</a><a id="Prepare-a-model-for-tuning-a-controller-1"></a><a class="docs-heading-anchor-permalink" href="#Prepare-a-model-for-tuning-a-controller" title="Permalink"></a></h2><p>The following steps are identical to the section <a href="../tune-your-first-model/#Tune-your-first-model">Tune your first model</a> they are developed to tune a non-linear model, needed to tune the controller. You can go to the next section if you already have the model.</p><p>Launch AutomationLabs on Julia:</p><pre><code class="language-julia hljs">julia&gt; using AutomationLabs</code></pre><p>Create a project, if not already created:</p><pre><code class="language-julia hljs">julia&gt; project(:create, name = &quot;QTP_test&quot;)</code></pre><p>Load the data from a quadruple tank process [1] on the <a href="https://github.com/AutomationLabs-sh/quadruple-tank-process">repository data.</a> The data of the dynamical system inputs can be added (you can have a look on <a href="../manage-your-first-data/#Manage-your-first-data">Manage your first data</a>):</p><pre><code class="language-julia hljs">julia&gt;  data(
          :add; 
          project_name = &quot;QTP_test&quot;, 
          path = &quot;paht_of_the_CSV_file&quot;,
          name = &quot;data_inputs_m3h&quot;,
       )</code></pre><p>The outputs of the dynamical system can be added to the database:</p><pre><code class="language-julia hljs">julia&gt; data(
          :add; 
          project_name = &quot;QTP_test&quot;, 
          path = &quot;paht_of_the_CSV_file&quot;,
          name = &quot;data_outputs&quot;,
       )</code></pre><p>Create the io data with bound on the raw data:</p><pre><code class="language-julia hljs">julia&gt;  lower_in = [0.2 0.2 0.2 0.2 -Inf -Inf]
        upper_in = [1.2 1.2 1.2 1.2 Inf Inf]
        lower_out = [0.2 0.2 0.2 0.2]
        upper_out = [1.2 1.2 1.2 1.2]

        data(:io;
                inputs_data_name =  &quot;data_inputs_m3h&quot;,
                outputs_data_name = &quot;data_outputs&quot;,
                project_name = &quot;QTP_test&quot;, 
                data_name = &quot;io_qtp&quot;,
                data_lower_input = lower_in,
                data_upper_input = upper_in,
                data_lower_output = lower_out,
                data_upper_output = upper_out,
            )</code></pre><p>Tune a non-linear model for dynamical system identification, such as:</p><pre><code class="language-julia hljs">julia&gt; using Dates </code></pre><pre><code class="language-julia hljs">julia&gt; model(:tune; 
          project_name = &quot;QTP_test&quot;,
          model_name = &quot;model_qtp_nonlinear&quot;,
          io = &quot;io_qtp&quot;,
          computation_solver = &quot;radam&quot;,
          computation_maximum_time = Dates.Minute(15),
          model_architecture = &quot;fnn&quot;, 
          )</code></pre><p>You now have a model of the quadruple tank process. It is now possible to go to the creation of the controller to control the dynamic system.</p><h2 id="Tune-a-linear-controller"><a class="docs-heading-anchor" href="#Tune-a-linear-controller">Tune a linear controller</a><a id="Tune-a-linear-controller-1"></a><a class="docs-heading-anchor-permalink" href="#Tune-a-linear-controller" title="Permalink"></a></h2><p>The first desired controller is a linear model predictive control with a quadratic cost function. To learn more about the control you can go to the guides section:</p><p><a href="quick_start/@ref]">Model predictive control</a></p><p>The linearization of the non linear model is performed at the state and input references. However, it is required to defined the constraints and the references, such as:</p><pre><code class="language-julia hljs">julia&gt;  hmin = 0.2;
        h1max = 1.36;
        h2max = 1.36;
        h3max = 1.30;
        h4max = 1.30;
        qmin = 0;
        qamax = 4;
        qbmax = 3.26;

        #Constraint definition:
        mpc_lower_state_constraints = [hmin, hmin, hmin, hmin]
        mpc_higher_state_constraints = [h1max, h2max, h3max, h4max]
        mpc_lower_input_constraints = [qmin, qmin]
        mpc_higher_input_constraints = [qamax, qbmax]

        mpc_state_reference = [0.65, 0.65, 0.65, 0.65]
        mpc_input_reference = [1.2, 1.2]</code></pre><p>Now we can set up the controller:</p><pre><code class="language-julia hljs">julia&gt;  c = controller(:tune; 
                project_name = &quot;QTP_test&quot;,
                model_name = &quot;model_qtp_nonlinear&quot;,
                controller_name = &quot;linear_controller&quot;,
                mpc_controller_type = &quot;model_predictive_control&quot;,
                mpc_programming_type = &quot;linear&quot;,
                mpc_lower_state_constraints = mpc_lower_statie_constraints,
                mpc_higher_state_constraints = mpc_higher_state_constraints,
                mpc_lower_input_constraints = mpc_lower_input_constraints,
                mpc_higher_input_constraints = mpc_higher_input_constraints,
                mpc_horizon = 6,
                mpc_sample_time = 5,
                mpc_state_reference = mpc_state_reference,
                mpc_input_reference = mpc_input_reference,       
            ) </code></pre><p>where <code>project_name</code> is the related project, <code>model_name</code> is the name used for tuning the controller, <code>mpc_controller_type</code> is the related control, <code>mpc programming_type</code> is the implementation method, <code>mpc_lower_state_constraints</code> is the state constraints, <code>mpc_higher_sate_constraints</code> is the state constraints, <code>mpc_lower_input_constraints</code> is the input control constraints, <code>mpc_higher_input_constraints</code> is the input control constraints, <code>mpc_horizon</code> is the horizon length, <code>mpc_sample_time</code> is the time between two samples, <code>mpc_state_reference</code> is the state reference and <code>mpc_input_reference</code> is the input reference related to the model predictive control.</p><p>You can list the controller from the project:</p><pre><code class="language-julia hljs">julia&gt; controller(:ls, project_name = &quot;QTP_test&quot;)</code></pre><p><img src="../list_controller.png" alt="plot-ls-controller-temporal-terminal"/></p><h2 id="Tune-a-non-linear-controller"><a class="docs-heading-anchor" href="#Tune-a-non-linear-controller">Tune a non-linear controller</a><a id="Tune-a-non-linear-controller-1"></a><a class="docs-heading-anchor-permalink" href="#Tune-a-non-linear-controller" title="Permalink"></a></h2><p>Previously we tuned a linear controller, we can also tune a non linear controller easily by changing the parameter <code>mpc_programming_type</code>, such as:</p><pre><code class="language-julia hljs">julia&gt;  c2 = controller(:tune; 
                project_name = &quot;QTP_test&quot;,
                model_name = &quot;model_qtp_nonlinear&quot;,
                controller_name = &quot;non_linear_controller&quot;,
                mpc_controller_type = &quot;model_predictive_control&quot;,
                mpc_programming_type = &quot;non_linear&quot;,
                mpc_lower_state_constraints = mpc_lower_state_constraints,
                mpc_higher_state_constraints = mpc_higher_state_constraints,
                mpc_lower_input_constraints = mpc_lower_input_constraints,
                mpc_higher_input_constraints = mpc_higher_input_constraints,
                mpc_horizon = 6,
                mpc_sample_time = 5,
                mpc_state_reference = mpc_state_reference,
                mpc_input_reference = mpc_input_reference,    
                mpc_solver = &quot;ipopt&quot;   
         )    </code></pre><p>where <code>project_name</code> is the related project, <code>model_name</code> is the name used for tuning the controller, <code>mpc_controller_type</code> is the related control, <code>mpc programming_type</code> is the implementation method, <code>mpc_lower_state_constraints</code> is the state constraints, <code>mpc_higher_sate_constraints</code> is the state constraints, <code>mpc_lower_input_constraints</code> is the input control constraints, <code>mpc_higher_input_constraints</code> is the input control constraints, <code>mpc_horizon</code> is the horizon length, <code>mpc_sample_time</code> is the time between two samples, <code>mpc_state_reference</code> is the state reference, <code>mpc_input_reference</code> is the input reference related to the model predictive control and <code>mpc_solver</code> allows you to choose the resolution solver.</p><p>You can list the controller from the project:</p><pre><code class="language-julia hljs">julia&gt; controller(:ls, project_name = &quot;QTP_test&quot;)</code></pre><p><img src="../list_controller_2.png" alt="plot-ls-controller-temporal-terminal"/></p><h2 id="Tune-a-mixed-integer-controller"><a class="docs-heading-anchor" href="#Tune-a-mixed-integer-controller">Tune a mixed integer controller</a><a id="Tune-a-mixed-integer-controller-1"></a><a class="docs-heading-anchor-permalink" href="#Tune-a-mixed-integer-controller" title="Permalink"></a></h2><p>Previously we tuned a non-linear model based on feedforward neural networks. The activation functions were <code>relu.</code> In this case it is possible to take into account the particularity of this activation function to reformulate the optimization problem with integer numbers. We can tune a controller with mixed integer programming, such as:</p><pre><code class="language-julia hljs">julia&gt; c3 = controller(:tune; 
                project_name = &quot;QTP_test&quot;,
                model_name = &quot;model_qtp_nonlinear&quot;,
                controller_name = &quot;mixed_linear_controller&quot;,
                mpc_controller_type = &quot;model_predictive_control&quot;,
                mpc_programming_type = &quot;mixed_linear&quot;,
                mpc_lower_state_constraints = mpc_lower_state_constraints,
                mpc_higher_state_constraints = mpc_higher_state_constraints,
                mpc_lower_input_constraints = mpc_lower_input_constraints,
                mpc_higher_input_constraints = mpc_higher_input_constraints,
                mpc_horizon = 6,
                mpc_sample_time = 5,
                mpc_state_reference = mpc_state_reference,
                mpc_input_reference = mpc_input_reference,    
         )</code></pre><p>where <code>project_name</code> is the related project, <code>model_name</code> is the name used for tuning the controller, <code>mpc_controller_type</code> is the related control, <code>mpc programming_type</code> is the implementation method, <code>mpc_lower_state_constraints</code> is the state constraints, <code>mpc_higher_sate_constraints</code> is the state constraints, <code>mpc_lower_input_constraints</code> is the input control constraints, <code>mpc_higher_input_constraints</code> is the input control constraints, <code>mpc_horizon</code> is the horizon length, <code>mpc_sample_time</code> is the time between two samples, <code>mpc_state_reference</code> is the state reference and<code>mpc_input_reference</code> is the input reference related to the model predictive control.</p><p>You can list the controller from the project:</p><pre><code class="language-julia hljs">julia&gt; controller(:ls, project_name = &quot;QTP_test&quot;)</code></pre><p><img src="../list_controller_3.png" alt="plot-ls-controller-temporal-terminal"/></p><h2 id="Calculate-a-controller"><a class="docs-heading-anchor" href="#Calculate-a-controller">Calculate a controller</a><a id="Calculate-a-controller-1"></a><a class="docs-heading-anchor-permalink" href="#Calculate-a-controller" title="Permalink"></a></h2><p>We can calculate the controller with a state intialization (or state measure), such as:</p><pre><code class="language-julia hljs">julia&gt; initialization = [0.6, 0.6, 0.6, 0.6]</code></pre><pre><code class="language-julia hljs">julia&gt; c = controller(:calculate; initialization =  initialization, predictive_controller = c)
       c2 = controller(:calculate; initialization =  initialization, predictive_controller = c2)
       c3 = controller(:calculate; initialization =  initialization, predictive_controller = c3)</code></pre><p>where <code>initialization</code> is the state initialization or the state measure and <code>predictive_controller</code> is the controller to calculate.</p><p>We can retrieve the computed state:</p><pre><code class="language-julia hljs">julia&gt;  c.computation_results.x
        c2.computation_results.x
        c3.computation_results.x</code></pre><p><img src="../calculate_controller.png" alt="plot-controller-results-terminal"/></p><p>We can retrieve the computed input control:</p><pre><code class="language-julia hljs">julia&gt;  c.computation_results.u</code></pre><p><img src="../calculate_controller_2.png" alt="plot-controller-results-terminal"/></p><h2 id="Delete-a-controller"><a class="docs-heading-anchor" href="#Delete-a-controller">Delete a controller</a><a id="Delete-a-controller-1"></a><a class="docs-heading-anchor-permalink" href="#Delete-a-controller" title="Permalink"></a></h2><p>It is possible to delete the tuned controllers from the database, such as:</p><pre><code class="language-julia hljs">julia&gt; controller(:rm, project_name = &quot;QTP_test&quot;, controller_name = &quot;non_linear_controller&quot;)</code></pre><h2 id="Reference"><a class="docs-heading-anchor" href="#Reference">Reference</a><a id="Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Reference" title="Permalink"></a></h2><p>[1] Blaud, P. C., Chevrel, P., Claveau, F., Haurant, P., &amp; Mouraud, A. (2022). ResNet and PolyNet based identification and (MPC) control of dynamical systems: a promising way. <em>IEEE Access</em>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tune-your-first-model/">« Tune your first model</a><a class="docs-footer-nextpage" href="../../guides/projects/administrate-projects/">Interact with projects »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Friday 16 December 2022 11:39">Friday 16 December 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
